<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Organization">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1">
<meta name="google-site-verification" content="k0e8DrbD40s54xHNBqwIsRrSSAkZoprwtEYDnNY06bU" />
<meta name="google-site-verification" content="pnjjbQFvjPwaWhEXY6nSyaS9iyghmH-M_yLHBveDX2M">
<meta itemprop="name" content="Unidata AWIPS User Manual - Distributed EDEX in the Cloud">
<meta itemprop="description" content="Polymer is a library that uses the latest web technologies to let you create custom HTML elements. Build anything from a button to a complete application as an encapsulated, reusable element that works across desktop and mobile.">


<meta itemprop="image" content="https://www.polymer-project.org/images/instacod.png">


<title>
  Unidata AWIPS User Manual
  
    - Distributed EDEX in the Cloud
  
</title>
<link rel="publisher" href="https://plus.google.com/107187849809354688692">
<link rel="shortcut icon" href="http://www.unidata.ucar.edu/favicon.ico">
<link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500|Source+Code+Pro:400,500,700" rel="stylesheet">
<link href="/awips2/css/site2.css?20161220" rel="stylesheet">
<link href="/awips2/css/site2_sd_rules.css?20161220" rel="stylesheet" shim-shadowdom>



<script src="/awips2/components/webcomponentsjs/webcomponents.min.js?20161220"></script>
<!-- TODO: remove when https://github.com/Polymer/polymer/issues/391 is fixed -->
<link rel="import" href="/awips2/components/polymer/polymer.html">
<link rel="stylesheet" href="/awips2/css/elements/docs-menu.css">
<link rel="import" href="/awips2/elements/common_elements.vulcanized.html?20161220">


</head>
<body id="distributed-edex-in-the-cloud">

<main id="content-container" class="polymer-content">
  <app-drawer id="sidebar" unresolved>
    <div layout vertical id="sidebar-content">
      <div id="logo-container" layout horizontal center>
        <a href="/awips2/" class="logo"><img style="width:200px;" src="/awips2/images/logos/awips2.png" alt="Unidata AWIPS User Guide"></a>
      </div>

      <docs-menu unresolved flex
		 baseurl='/awips2'
                 coreElements='{"core-header-panel":"components/core-header-panel/core-header-panel.html","core-transition-pages":"components/core-animated-pages/transitions/core-transition-pages.html","core-animated-pages":"components/core-animated-pages/core-animated-pages.html","core-overlay":"components/core-overlay/core-overlay.html","core-toolbar":"components/core-toolbar/core-toolbar.html","core-image":"components/core-image/core-image.html","core-shared-lib":"components/core-shared-lib/core-shared-lib.html","core-a11y-keys":"components/core-a11y-keys/core-a11y-keys.html","core-menu-button":"components/core-menu-button/core-menu-button.html","core-icon":"components/core-icon/core-icon.html","core-selection":"components/core-selection/core-selection.html","core-style":"components/core-style/core-style.html","core-menu":"components/core-menu/core-menu.html","core-submenu":"components/core-menu/core-submenu.html","core-list":"components/core-list/core-list.html","core-dropdown-menu":"components/core-dropdown-menu/core-dropdown-menu.html","core-input":"components/core-input/core-input.html","core-iconset-svg":"components/core-iconset-svg/core-iconset-svg.html","core-field":"components/core-field/core-field.html","core-selector":"components/core-selector/core-selector.html","core-media-query":"components/core-media-query/core-media-query.html","core-animation-group":"components/core-animation/core-animation-group.html","core-animation":"components/core-animation/core-animation.html","core-animation-keyframe":"components/core-animation/core-animation.html","core-animation-prop":"components/core-animation/core-animation.html","core-dropdown":"components/core-dropdown/core-dropdown.html","core-dropdown-base":"components/core-dropdown/core-dropdown-base.html","core-pages":"components/core-pages/core-pages.html","core-meta":"components/core-meta/core-meta.html","core-splitter":"components/core-splitter/core-splitter.html","core-scroll-header-panel":"components/core-scroll-header-panel/core-scroll-header-panel.html","core-tooltip":"components/core-tooltip/core-tooltip.html","core-localstorage":"components/core-localstorage/core-localstorage.html","core-scroll-threshold":"components/core-scroll-threshold/core-scroll-threshold.html","core-drag-drop":"components/core-drag-drop/core-drag-drop.html","core-iconset":"components/core-iconset/core-iconset.html","core-label":"components/core-label/core-label.html","core-signals":"components/core-signals/core-signals.html","core-transition":"components/core-transition/core-transition.html","core-scaffold":"components/core-scaffold/core-scaffold.html","core-drawer-panel":"components/core-drawer-panel/core-drawer-panel.html","core-range":"components/core-range/core-range.html","core-collapse":"components/core-collapse/core-collapse.html","core-xhr":"components/core-ajax/core-xhr.html","core-ajax":"components/core-ajax/core-ajax.html","core-icon-button":"components/core-icon-button/core-icon-button.html","core-item":"components/core-item/core-item.html"}'
                 paperElements='{"paper-dropdown":"components/paper-dropdown/paper-dropdown.html","paper-dropdown-transition":"components/paper-dropdown/paper-dropdown-transition.html","paper-item":"components/paper-item/paper-item.html","paper-dropdown-menu":"components/paper-dropdown-menu/paper-dropdown-menu.html","paper-checkbox":"components/paper-checkbox/paper-checkbox.html","paper-button":"components/paper-button/paper-button.html","paper-button-base":"components/paper-button/paper-button-base.html","paper-menu-button":"components/paper-menu-button/paper-menu-button.html","paper-radio-group":"components/paper-radio-group/paper-radio-group.html","paper-toast":"components/paper-toast/paper-toast.html","paper-char-counter":"components/paper-input/paper-char-counter.html","paper-autogrow-textarea":"components/paper-input/paper-autogrow-textarea.html","paper-input":"components/paper-input/paper-input.html","paper-input-decorator":"components/paper-input/paper-input-decorator.html","paper-slider":"components/paper-slider/paper-slider.html","paper-toggle-button":"components/paper-toggle-button/paper-toggle-button.html","paper-fab":"components/paper-fab/paper-fab.html","paper-ripple":"components/paper-ripple/paper-ripple.html","paper-icon-button":"components/paper-icon-button/paper-icon-button.html","paper-tabs":"components/paper-tabs/paper-tabs.html","paper-tab":"components/paper-tabs/paper-tab.html","paper-shadow":"components/paper-shadow/paper-shadow.html","paper-radio-button":"components/paper-radio-button/paper-radio-button.html","paper-dialog":"components/paper-dialog/paper-dialog.html","paper-action-dialog":"components/paper-dialog/paper-action-dialog.html","paper-dialog-base":"components/paper-dialog/paper-dialog-base.html","paper-dialog-transition":"components/paper-dialog/paper-dialog-transition.html","paper-spinner":"components/paper-spinner/paper-spinner.html","paper-progress":"components/paper-progress/paper-progress.html"}'></docs-menu>
    </div>
  </app-drawer>

  <scroll-area sidebar unresolved class="scrolling">
    <site-banner type="guide" shortname="Docs" unresolved>
      
<app-bar theme="light" class="bar fixed">
</app-bar>


          
      <header class="shrink">
        <h1>
             Distributed EDEX in the Cloud
        </h1>
      </header>
          
    </site-banner>

    
    

    <article class="show-permalinks">

      <header class="onlyonmobile">
        <h1>
          : Distributed EDEX in the Cloud
        </h1>
      </header>

      <p>An example of a two-server configuration (LDM and EDEX seperately) using Microsoft Azure CentOS 7.2 virtual machines (Unidata EDEX is supported on CentOS/RHEL 7 since 16.2.2).</p>

<h1 id="cifs-setup">cifs setup</h1>

<p>Following the guide <a href="https://docs.microsoft.com/en-us/azure/storage/storage-how-to-use-files-linux">https://docs.microsoft.com/en-us/azure/storage/storage-how-to-use-files-linux</a>, our two Azure VMs will share a single file storage directory mounted via Samba <strong>cifs</strong>.   LDM will write to the file share, and EDEX will read from it to ingest and decode IDD products.</p>

<p>In the <a href="https://portal.azure.com">Azure portal</a>:</p>

<ul>
  <li>Create a new  <strong>Standard</strong> storage account (e.g. <strong>edex7203</strong>)</li>
  <li>Create a new <strong>File service</strong> within the storange account (e.g. <strong>datastore</strong>), 100GB minimum.</li>
  <li>The file service will be located at <strong>//edex7203.file.core.windows.net/datastore</strong></li>
  <li>Select the <strong>Configuration</strong> tab and confirm <strong>Standard Performance</strong> and <strong>Locally-redundant storage (LRS)</strong> for Replication (these should be defaults).</li>
  <li>Select the <strong>Access keys</strong> tab and copy one of the keys for <code>/etc/fstab</code></li>
</ul>

<p><code>/etc/fstab</code> should look like this (<strong>for both machines</strong>):</p>

<pre><code>UUID=0177d0ac-2605-4bfb-9873-5bdefea12fe2 / xfs defaults 0 0
//edex7203.file.core.windows.net/datastore /awips2/data_store cifs vers=3.0,password=YOUR_KEY_HERE,user=edex7203,dir_mode=0777,file_mode=0777
</code></pre>

<p>Note the <code>YOUR_KEY_HERE</code> placeholder above, that’s where your key will go.</p>

<p>Now run <code>mount -a</code> and confirm <code>/awips2/data_store</code> is mounted with the command <code>df -h</code></p>

<pre><code>Filesystem                                  Size  Used Avail Use% Mounted on
/dev/sda1                                    30G  7.4G   23G  25% /
/dev/sdb1                                    14G   41M   13G   1% /mnt/resource
//edex7203.file.core.windows.net/datastore  100G    1M  100G   1% /awips2/data_store
</code></pre>

<hr />

<h1 id="edex-server-10001">EDEX server (10.0.0.1)</h1>

<p>In the <a href="https://portal.azure.com">Azure portal</a>:</p>

<ol>
  <li>Create a new virtual machine with an <em>awips</em> user account
    <ul>
      <li><strong>CentOS 7.2</strong></li>
      <li><strong>DS5_V2 Standard</strong> (16 cores, 56 GB)</li>
    </ul>
  </li>
  <li>Ensure that this VM is on the same <strong>Virtual Network</strong> as the LDM machine (both on the 10.0.0.* subnet).</li>
  <li>Select the new vm, then select <strong>Disks</strong>, and modify the attached <strong>OS Disk</strong> to be 512GB or greater (vm must be stopped for this).</li>
  <li>Start the VM, log in as root, and follow the steps in the guide <a href="https://blogs.msdn.microsoft.com/cloud_solution_architect/2016/05/24/step-by-step-how-to-resize-a-linux-vm-os-disk-in-azure-arm/">Step by Step: how to resize a Linux VM OS disk in Azure</a> (with one dfference in step 5 below)
    <ul>
      <li><strong>fdisk /dev/sda</strong></li>
      <li>type “<strong>u</strong>” to change the units to sectors.</li>
      <li>type “<strong>p</strong>” to list current partition details.</li>
      <li>type “<strong>d</strong>” to delete the current partition.</li>
      <li>type “<strong>n</strong>” to create a new partition. Select defaults (p for primary partition, 1 for first part).</li>
      <li>type “<strong>w</strong>” to write the partition.</li>
    </ul>
  </li>
  <li>Reboot the machine and log in again (as root).</li>
  <li>
    <p>Run <code>xfs_growfs /dev/sda1</code> and check that the OS disk mounts with the new  partition size with <code>df -h</code></p>

    <blockquote>
      <p>We use <strong>xfs_growfs</strong> here for XFS here (<a href="http://ask.xmodulo.com/expand-xfs-file-system.html">read more…</a>) instead of <strong>resize2fs</strong> for EXT2/EXT3/EXT4.</p>
    </blockquote>
  </li>
  <li>
    <p><code>yum install iptables-services</code></p>
  </li>
  <li>
    <p><code>vi /etc/sysconfig/iptables</code></p>

    <pre><code> *filter
 :INPUT ACCEPT [0:0]
 :FORWARD ACCEPT [0:0]
 :OUTPUT ACCEPT [0:0]
 -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
 -A INPUT -p icmp -j ACCEPT
 -A INPUT -i lo -j ACCEPT
 -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
 -A INPUT -m state --state NEW -m tcp -p tcp --dport 5672 -j ACCEPT
 -A INPUT -m state --state NEW -m tcp -p tcp --dport 9581 -j ACCEPT
 -A INPUT -m state --state NEW -m tcp -p tcp --dport 9582 -j ACCEPT
 -A INPUT -j REJECT --reject-with icmp-host-prohibited
 -A FORWARD -j REJECT --reject-with icmp-host-prohibited
 COMMIT
</code></pre>
  </li>
  <li>
    <p><code>service iptables restart</code></p>
  </li>
  <li>
    <p><code>vi /etc/sysconfig/selinux</code> (<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security-Enhanced_Linux/sect-Security-Enhanced_Linux-Enabling_and_Disabling_SELinux-Disabling_SELinux.html">read more about selinux at redhat.com</a>)</p>

    <pre><code># This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of these two values:
#     targeted - Targeted processes are protected,
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted
</code></pre>
  </li>
  <li>
    <p><code>reboot</code> for the selinux changes to take effect.</p>
  </li>
  <li>
    <p>Create user and group <strong>awips:fxalpha</strong></p>

    <p><code>groupadd fxalpha &amp;&amp; useradd -G fxalpha awips</code></p>

    <p>or if the awips account already exists:</p>

    <p><code>groupadd fxalpha &amp;&amp; usermod -G fxalpha awips</code></p>
  </li>
  <li>
    <p>Finally, install the EDEX server</p>

    <p><code>wget http://www.unidata.ucar.edu/software/awips2/installEDEX.sh</code></p>

    <p><code>chmod 755 ./installEDEX.sh</code></p>

    <p><code>./installEDEX.sh</code></p>
  </li>
</ol>

<hr />

<h1 id="ldm-server-10002">LDM server (10.0.0.2)</h1>

<p>A small LDM server to write data files to the file share <code>/awips2/data_store</code> and send messages to the EDEX machine (10.0.0.1) via <strong>edexBridge</strong>.</p>

<p>In the <a href="https://portal.azure.com">Azure portal</a>:</p>

<ol>
  <li>Create a new virtual machine with an <em>awips</em> user account
    <ul>
      <li><strong>CentOS 7.2</strong></li>
      <li><strong>DS2_V2 Standard</strong> (2 cores, 7 GB)</li>
    </ul>
  </li>
  <li>
    <p>Start the VM, log in and <code>sudo su -</code> to root, then run</p>

    <ul>
      <li>
        <p><code>wget -O /etc/yum.repos.d/awips2.repo http://www.unidata.ucar.edu/software/awips2/doc/el7.repo</code></p>
      </li>
      <li>
        <p><code>yum clean all</code></p>
      </li>
      <li>
        <p><code>yum groupinstall awips2-ldm-server</code></p>
      </li>
      <li>
        <p><code>vi /awips2/ldm/etc/ldmd.conf</code> to define the <strong>edexBridge</strong> server nane</p>

        <pre><code>  EXEC    "edexBridge -s 10.0.0.1"
</code></pre>
      </li>
      <li>
        <p><code>service edex_ldm start</code></p>
      </li>
    </ul>

    <blockquote>
      <p>Note: You <em>do not</em> need to configure iptables on an LDM-only machine (only for EDEX).</p>
    </blockquote>
  </li>
</ol>


    </article>

    <footer>
  <div>
    <div class="links">
      <a href="https://www.facebook.com/unidata" title="Unidata on Facebook" tabindex="-1"><paper-button><core-icon icon="social:post-facebook"></core-icon>Facebook</paper-button></a>
      <a href="https://twitter.com/intent/follow?screen_name=unidata" data-twitter-follow title="Follow @Unidata on Twitter" tabindex="-1"><paper-button><core-icon icon="social:post-twitter"></core-icon>Twitter</paper-button></a>
      <a href="https://github.com/Unidata/awips2"><paper-button class="github" tabindex="-1"><core-icon icon="social:post-github"></core-icon>GitHub</paper-button></a>
      <a href="https://github.com/Unidata/awips2/issues/new" tabindex="-1"><paper-button><core-icon icon="bug-report"></core-icon>File a bug</paper-button></a>
    </div>

  </div>
</footer>





<script src="/awips2/js/prettify/prettify.js"></script>

<!-- <script src="/awips2/js/bower_components/smoothscroll/smoothscroll.js"></script> -->
<script src="/awips2/js/app.js?20161220"></script>


  </scroll-area>

</main>

</body>
</html>
