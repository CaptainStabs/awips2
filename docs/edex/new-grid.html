<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Organization">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1">
<meta name="google-site-verification" content="k0e8DrbD40s54xHNBqwIsRrSSAkZoprwtEYDnNY06bU" />
<meta name="google-site-verification" content="pnjjbQFvjPwaWhEXY6nSyaS9iyghmH-M_yLHBveDX2M">
<meta itemprop="name" content="Unidata AWIPS User Manual - Add a New Grid to EDEX">
<meta itemprop="description" content="Polymer is a library that uses the latest web technologies to let you create custom HTML elements. Build anything from a button to a complete application as an encapsulated, reusable element that works across desktop and mobile.">


<meta itemprop="image" content="https://www.polymer-project.org/images/instacod.png">


<title>
  
    Add a New Grid to EDEX - 
  
  Unidata AWIPS User Manual
</title>
<link rel="publisher" href="https://plus.google.com/107187849809354688692">
<link rel="shortcut icon" href="http://www.unidata.ucar.edu/favicon.ico">
<link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500|Source+Code+Pro:400,500,700" rel="stylesheet">
<link href="/awips2/css/site2.css?20170404" rel="stylesheet">
<link href="/awips2/css/site2_sd_rules.css?20170404" rel="stylesheet" shim-shadowdom>



<script src="/awips2/components/webcomponentsjs/webcomponents.min.js?20170404"></script>
<!-- TODO: remove when https://github.com/Polymer/polymer/issues/391 is fixed -->
<link rel="import" href="/awips2/components/polymer/polymer.html">
<link rel="stylesheet" href="/awips2/css/elements/docs-menu.css">
<link rel="import" href="/awips2/elements/common_elements.vulcanized.html?20170404">


</head>
<body id="add-a-new-grid-to-edex">

<main id="content-container" class="polymer-content">
  <app-drawer id="sidebar" unresolved>
    <div layout vertical id="sidebar-content">
      <div id="logo-container" layout horizontal center>
        <a href="/awips2/" class="logo"><img style="width:200px;" src="/awips2/images/logos/awips2.png" alt="Unidata AWIPS User Guide"></a>
      </div>

      <docs-menu unresolved flex
		 baseurl='/awips2'
                 coreElements='{"core-a11y-keys":"components/core-a11y-keys/core-a11y-keys.html","core-ajax":"components/core-ajax/core-ajax.html","core-xhr":"components/core-ajax/core-xhr.html","core-animated-pages":"components/core-animated-pages/core-animated-pages.html","core-transition-pages":"components/core-animated-pages/transitions/core-transition-pages.html","core-animation-group":"components/core-animation/core-animation-group.html","core-animation":"components/core-animation/core-animation.html","core-animation-keyframe":"components/core-animation/core-animation.html","core-animation-prop":"components/core-animation/core-animation.html","core-collapse":"components/core-collapse/core-collapse.html","core-drag-drop":"components/core-drag-drop/core-drag-drop.html","core-drawer-panel":"components/core-drawer-panel/core-drawer-panel.html","core-dropdown-base":"components/core-dropdown/core-dropdown-base.html","core-dropdown":"components/core-dropdown/core-dropdown.html","core-dropdown-menu":"components/core-dropdown-menu/core-dropdown-menu.html","core-field":"components/core-field/core-field.html","core-header-panel":"components/core-header-panel/core-header-panel.html","core-icon":"components/core-icon/core-icon.html","core-icon-button":"components/core-icon-button/core-icon-button.html","core-iconset":"components/core-iconset/core-iconset.html","core-iconset-svg":"components/core-iconset-svg/core-iconset-svg.html","core-image":"components/core-image/core-image.html","core-input":"components/core-input/core-input.html","core-item":"components/core-item/core-item.html","core-label":"components/core-label/core-label.html","core-list":"components/core-list/core-list.html","core-localstorage":"components/core-localstorage/core-localstorage.html","core-media-query":"components/core-media-query/core-media-query.html","core-menu":"components/core-menu/core-menu.html","core-submenu":"components/core-menu/core-submenu.html","core-menu-button":"components/core-menu-button/core-menu-button.html","core-meta":"components/core-meta/core-meta.html","core-overlay":"components/core-overlay/core-overlay.html","core-pages":"components/core-pages/core-pages.html","core-range":"components/core-range/core-range.html","core-scaffold":"components/core-scaffold/core-scaffold.html","core-scroll-header-panel":"components/core-scroll-header-panel/core-scroll-header-panel.html","core-scroll-threshold":"components/core-scroll-threshold/core-scroll-threshold.html","core-selection":"components/core-selection/core-selection.html","core-selector":"components/core-selector/core-selector.html","core-shared-lib":"components/core-shared-lib/core-shared-lib.html","core-signals":"components/core-signals/core-signals.html","core-splitter":"components/core-splitter/core-splitter.html","core-style":"components/core-style/core-style.html","core-toolbar":"components/core-toolbar/core-toolbar.html","core-tooltip":"components/core-tooltip/core-tooltip.html","core-transition":"components/core-transition/core-transition.html"}'
                 paperElements='{"paper-button-base":"components/paper-button/paper-button-base.html","paper-button":"components/paper-button/paper-button.html","paper-checkbox":"components/paper-checkbox/paper-checkbox.html","paper-action-dialog":"components/paper-dialog/paper-action-dialog.html","paper-dialog-base":"components/paper-dialog/paper-dialog-base.html","paper-dialog-transition":"components/paper-dialog/paper-dialog-transition.html","paper-dialog":"components/paper-dialog/paper-dialog.html","paper-dropdown-transition":"components/paper-dropdown/paper-dropdown-transition.html","paper-dropdown":"components/paper-dropdown/paper-dropdown.html","paper-dropdown-menu":"components/paper-dropdown-menu/paper-dropdown-menu.html","paper-fab":"components/paper-fab/paper-fab.html","paper-icon-button":"components/paper-icon-button/paper-icon-button.html","paper-autogrow-textarea":"components/paper-input/paper-autogrow-textarea.html","paper-char-counter":"components/paper-input/paper-char-counter.html","paper-input-decorator":"components/paper-input/paper-input-decorator.html","paper-input":"components/paper-input/paper-input.html","paper-item":"components/paper-item/paper-item.html","paper-menu-button":"components/paper-menu-button/paper-menu-button.html","paper-progress":"components/paper-progress/paper-progress.html","paper-radio-button":"components/paper-radio-button/paper-radio-button.html","paper-radio-group":"components/paper-radio-group/paper-radio-group.html","paper-ripple":"components/paper-ripple/paper-ripple.html","paper-shadow":"components/paper-shadow/paper-shadow.html","paper-slider":"components/paper-slider/paper-slider.html","paper-spinner":"components/paper-spinner/paper-spinner.html","paper-tab":"components/paper-tabs/paper-tab.html","paper-tabs":"components/paper-tabs/paper-tabs.html","paper-toast":"components/paper-toast/paper-toast.html","paper-toggle-button":"components/paper-toggle-button/paper-toggle-button.html"}'></docs-menu>
    </div>
  </app-drawer>

  <scroll-area sidebar unresolved class="scrolling">
    <site-banner type="guide" shortname="Docs" unresolved>
      
<app-bar theme="light" class="bar fixed">
</app-bar>


          
      <header class="shrink">
        <h1>
             Add a New Grid to EDEX
        </h1>
      </header>
          
    </site-banner>

    
    

    <article class="show-permalinks">

      <header class="onlyonmobile">
        <h1>
          : Add a New Grid to EDEX
        </h1>
      </header>

      <p>Unrecognized grids can be decoded by EDEX simply by dropping <code>*.grib</code> or <code>*.grib2</code> files into <code>/awips2/data_store/ingest/</code></p>

<p>To add support for a new grid, two edits must be made:</p>

<ul>
  <li><strong>Geospatial projection</strong> must be defined in a <em>grid navigation file</em></li>
  <li><strong>Grid name</strong>, <strong>center</strong>, <strong>subcenter</strong>, and <strong>process ID</strong> must be defined in a <em>model definition file</em>.</li>
</ul>

<h1 id="ingest-an-unsupported-grid">Ingest an Unsupported Grid</h1>

<ol>
  <li>
    <p>Download an example grib1 file and rename to a <code>*.grib</code> extension, then copy to the manual ingest point <code>/awips2/data_store/ingest/</code></p>

    <pre><code> wget http://www.unidata.ucar.edu/staff/mjames/14102318_nmm_d01.GrbF00600 -O wrf.grib

 cp wrf.grib /awips2/data_store/ingest/
</code></pre>

    <p>Remember that the data distribution file (<code>/awips2/edex/data/utility/edex_static/base/distribution/grib.xml</code>) will match filename which have the <code>*.grib</code> extension.</p>
  </li>
  <li>
    <p>Confirm that the grib file decodes in the grib log file:</p>

    <pre><code> edex log grib

 INFO [Ingest.GribDecode] /awips2/data_store/manual/grib/20141026/14/wrf.grib processed in: 0.1200 (sec) Latency: 21.8080 (sec)
 INFO [Ingest.GribDecode] /awips2/data_store/manual/grib/20141026/14/wrf.grib processed in: 0.1180 (sec) Latency: 21.8140 (sec)
 INFO [Ingest.GribDecode] /awips2/data_store/manual/grib/20141026/14/wrf.grib processed in: 0.4230 (sec) Latency: 21.8360 (sec)
 INFO [Ingest.GribDecode] /awips2/data_store/manual/grib/20141026/14/wrf.grib processed in: 0.2240 (sec) Latency: 21.9140 (sec)
    
 ...
</code></pre>
  </li>
  <li>
    <p>Check that the hdf5 data directory exists for our unnamed grid</p>

    <pre><code> ls -latr /awips2/edex/data/hdf5/grid/GribModel:7:0:89
</code></pre>

    <p>Though the grib file has been decoded, it has been given a generic name with its center, subcenter, and process IDs (7, 0, 89, respectively).</p>
  </li>
</ol>

<h1 id="determine-grid-projection">Determine Grid Projection</h1>

<p>When the grid was ingested a record was added to the <code>grid_coverage</code> table with its navigation information:</p>

<pre><code>psql metadata

metadata=# select nx,ny,dx,dy,majoraxis,minoraxis,la1,lo1,lov,latin1,latin2 from gridcoverage where id=(select distinct(location_id) from grid_info where datasetid='GribModel:7:0:89');
 nx  | ny  |        dx        |        dy        | majoraxis | minoraxis |       la1        |        lo1        |        lov        |      latin1      |      latin2      
-----+-----+------------------+------------------+-----------+-----------+------------------+-------------------+-------------------+------------------+------------------
 201 | 155 | 4.29699993133545 | 4.29699993133545 |   6378160 |   6356775 | 42.2830009460449 | -72.3610000610352 | -67.0770034790039 | 45.3680000305176 | 45.3680000305176
(1 row)
</code></pre>

<p>Compare with the projection info returned by wgrib on the original file:</p>

<pre><code>wgrib -V wrf.grib

rec 799:27785754:date 2014102318 ALBDO kpds5=84 kpds6=1 kpds7=0 levels=(0,0) grid=255 sfc 6hr fcst: bitmap: 736 undef
  ALBDO=Albedo [%]
  timerange 0 P1 6 P2 0 TimeU 1  nx 201 ny 155 GDS grid 3 num_in_ave 0 missing 0
  center 7 subcenter 0 process 89 Table 2 scan: WE:SN winds(grid) 
  Lambert Conf: Lat1 42.283000 Lon1 -72.361000 Lov -67.077000
      Latin1 45.368000 Latin2 45.368000 LatSP 0.000000 LonSP 0.000000
      North Pole (201 x 155) Dx 4.297000 Dy 4.297000 scan 64 mode 8
  min/max data 5 21.9  num bits 8  BDS_Ref 50  DecScale 1 BinScale 0
</code></pre>

<p>Notice that our grib1 file is a <strong>Lambert Conformal</strong> projection.  We will need these values for the next step. Note that <strong>there is a tolerance of +/- 0.1 degrees</strong> to keep in mind when defining your coverage area.</p>

<h1 id="create-grid-projection-file">Create Grid Projection File</h1>

<p>Grid projection files are stored in <code>/awips2/edex/data/utility/edex_static/base/grib/grids/</code> and there are four grid coverage types available:</p>

<ol>
  <li>
    <p><strong>lambertConformalGridCoverage</strong> example</p>

    <pre><code> &lt;lambertConformalGridCoverage&gt;
     &lt;name&gt;305&lt;/name&gt;
     &lt;description&gt;Regional - CONUS (Lambert Conformal)&lt;/description&gt;
     &lt;la1&gt;16.322&lt;/la1&gt;
     &lt;lo1&gt;-125.955&lt;/lo1&gt;
     &lt;firstGridPointCorner&gt;LowerLeft&lt;/firstGridPointCorner&gt;
     &lt;nx&gt;151&lt;/nx&gt;
     &lt;ny&gt;113&lt;/ny&gt;
     &lt;dx&gt;40.63525&lt;/dx&gt;
     &lt;dy&gt;40.63525&lt;/dy&gt;
     &lt;spacingUnit&gt;km&lt;/spacingUnit&gt;
     &lt;minorAxis&gt;6356775.0&lt;/minorAxis&gt;
     &lt;majorAxis&gt;6378160.0&lt;/majorAxis&gt;
     &lt;lov&gt;-95.0&lt;/lov&gt;
     &lt;latin1&gt;25.0&lt;/latin1&gt;
     &lt;latin2&gt;25.0&lt;/latin2&gt;
 &lt;/lambertConformalGridCoverage&gt;
</code></pre>
  </li>
  <li>
    <p><strong>polarStereoGridCoverage</strong> example</p>

    <pre><code> &lt;polarStereoGridCoverage&gt;
     &lt;name&gt;405&lt;/name&gt;
     &lt;description&gt;Sea Ice south 690X710 13km grid&lt;/description&gt;
     &lt;la1&gt;-36.866&lt;/la1&gt;
     &lt;lo1&gt;139.806&lt;/lo1&gt;
     &lt;firstGridPointCorner&gt;LowerLeft&lt;/firstGridPointCorner&gt;
     &lt;nx&gt;690&lt;/nx&gt;
     &lt;ny&gt;710&lt;/ny&gt;
     &lt;dx&gt;12.7&lt;/dx&gt;
     &lt;dy&gt;12.7&lt;/dy&gt;
     &lt;spacingUnit&gt;km&lt;/spacingUnit&gt;
     &lt;minorAxis&gt;6371229.0&lt;/minorAxis&gt;
     &lt;majorAxis&gt;6371229.0&lt;/majorAxis&gt;
     &lt;lov&gt;100.0&lt;/lov&gt;
 &lt;/polarStereoGridCoverage&gt;
</code></pre>
  </li>
  <li>
    <p><strong>latLonGridCoverage</strong> example</p>

    <pre><code> &lt;latLonGridCoverage&gt;
     &lt;name&gt;864162002&lt;/name&gt;
     &lt;description&gt;UKMet HiRes combined - Southern Hemisphere
         Longitude range 71.25E - 70.416E &lt;/description&gt;
     &lt;la1&gt;-89.721&lt;/la1&gt;
     &lt;lo1&gt;71.25&lt;/lo1&gt;
     &lt;firstGridPointCorner&gt;LowerLeft&lt;/firstGridPointCorner&gt;
     &lt;nx&gt;864&lt;/nx&gt;
     &lt;ny&gt;162&lt;/ny&gt;
     &lt;dx&gt;0.833&lt;/dx&gt;
     &lt;dy&gt;0.556&lt;/dy&gt;
     &lt;spacingUnit&gt;degree&lt;/spacingUnit&gt;
     &lt;la2&gt;-0.278&lt;/la2&gt;
     &lt;lo2&gt;70.416&lt;/lo2&gt;
 &lt;/latLonGridCoverage&gt;
</code></pre>
  </li>
  <li>
    <p><strong>mercatorGridCoverage</strong> example</p>

    <pre><code> &lt;mercatorGridCoverage&gt;
     &lt;name&gt;NBM_PR&lt;/name&gt;
     &lt;description&gt; National Blend Grid over Puerto Rico - (1.25 km)&lt;/description&gt;
     &lt;la1&gt;16.9775&lt;/la1&gt;
     &lt;lo1&gt;-68.0278&lt;/lo1&gt;
     &lt;firstGridPointCorner&gt;LowerLeft&lt;/firstGridPointCorner&gt;
     &lt;nx&gt;339&lt;/nx&gt;
     &lt;ny&gt;225&lt;/ny&gt;
     &lt;dx&gt;1.25&lt;/dx&gt;
     &lt;dy&gt;1.25&lt;/dy&gt;
     &lt;la2&gt;19.3750032477232&lt;/la2&gt;
     &lt;lo2&gt;-63.984399999999994&lt;/lo2&gt;
     &lt;latin&gt;20&lt;/latin&gt;
     &lt;spacingUnit&gt;km&lt;/spacingUnit&gt;
     &lt;minorAxis&gt;6371200&lt;/minorAxis&gt;
     &lt;majorAxis&gt;6371200&lt;/majorAxis&gt;
 &lt;/mercatorGridCoverage&gt;
</code></pre>
  </li>
</ol>

<p>Copy an existing file file with the same grid projection type (in this case <strong>lambertConformalGridCoverage</strong>) to a new file <code>wrf.xml</code></p>

<pre><code>cd /awips2/edex/data/utility/edex_static/base/grib/grids/
cp RUCIcing.xml wrf.xml
</code></pre>

<p>And edit the new <code>wrf.xml</code> to define the projection values (example provided):</p>

<pre><code>vi wrf.xml

&lt;lambertConformalGridCoverage&gt;
    &lt;name&gt;201155&lt;/name&gt;
    &lt;description&gt;Regional - CONUS (Lambert Conformal)&lt;/description&gt;
    &lt;la1&gt;42.2830009460449&lt;/la1&gt;
    &lt;lo1&gt;-72.3610000610352&lt;/lo1&gt;
    &lt;firstGridPointCorner&gt;LowerLeft&lt;/firstGridPointCorner&gt;
    &lt;nx&gt;201&lt;/nx&gt;
    &lt;ny&gt;155&lt;/ny&gt;
    &lt;dx&gt;4.29699993133545&lt;/dx&gt;
    &lt;dy&gt;4.29699993133545&lt;/dy&gt;
    &lt;spacingUnit&gt;km&lt;/spacingUnit&gt;
    &lt;minorAxis&gt;6356775.0&lt;/minorAxis&gt;
    &lt;majorAxis&gt;6378160.0&lt;/majorAxis&gt;
    &lt;lov&gt;-67.0770034790039&lt;/lov&gt;
    &lt;latin1&gt;45.3680000305176&lt;/latin1&gt;
    &lt;latin2&gt;45.3680000305176&lt;/latin2&gt;
&lt;/lambertConformalGridCoverage&gt;
</code></pre>

<blockquote>
  <p>Notice <code>&lt;name&gt;201155&lt;/name&gt;</code> defined from the number of grid points (201 x 155). This value will be matched against an entry in our models file (below) to set the name of the model (e.g. WRF).</p>
</blockquote>

<h1 id="create-model-definition">Create Model Definition</h1>

<p>Model definition XML files are found in <strong>/awips2/edex/data/utility/edex_static/base/grid/models/</strong>. Since our grib1 file has a center ID of 7 (NCEP) we will edit the <strong>gribModels_NCEP-7.xml</strong> file.</p>

<pre><code>cd /awips2/edex/data/utility/edex_static/base/grib/models/

vi gribModels_NCEP-7.xml
</code></pre>

<p>in <code>&lt;gribModelSet&gt;</code> add an entry</p>

<pre><code>    &lt;model&gt;
        &lt;name&gt;WRF&lt;/name&gt;
        &lt;center&gt;7&lt;/center&gt;
        &lt;subcenter&gt;0&lt;/subcenter&gt;
        &lt;grid&gt;201155&lt;/grid&gt;
        &lt;process&gt;
            &lt;id&gt;89&lt;/id&gt;
        &lt;/process&gt;
    &lt;/model&gt;
</code></pre>

<p>save the file and restart EDEX for the changes to take effect.</p>

<pre><code>sudo service edex_camel restart
</code></pre>

<p>Now copy the <code>wrf.grib</code> file <em>again</em> to <strong>/awips2/data_store/ingest/</strong>.  If everything is correct we will not see any persistence errors since the grid is now named <strong>WRF</strong> and not <strong>GribModel:7:0:89</strong>.</p>

<pre><code>cp wrd.grib /awips2/data_store/ingest/

edex log grib
</code></pre>

<p>After you have confirmed that the grid was ingested with the given name, you can <a href="../cave/d2d-edit-menus.html">edit the D2D product menus to display the new grid</a>.</p>

<h1 id="troubleshooting-grib-ingest">Troubleshooting Grib Ingest</h1>

<p>If you ingest a piece of data and the parameter appears as unknown in the metadata database, ensure that the correct parameter tables are in place for the center/subcenter.</p>

<p>Make sure the latitude and longitude entries in your coverage specification file match those of your ingested raw grib file. There is a tolerance of +/- 0.1 degree to keep in mind when defining your coverage area.</p>

<p>If some of the information is unknown, using a grib utility application such as <em>wgrib</em> and <em>wgrib2</em> (not delivered) can be useful in determining the information that must be added to correctly process a new grib file.</p>

    </article>

    <footer>
  <div>
    <div class="links">
      <a href="https://www.facebook.com/unidata" title="Unidata on Facebook" tabindex="-1"><paper-button><core-icon icon="social:post-facebook"></core-icon>Facebook</paper-button></a>
      <a href="https://twitter.com/intent/follow?screen_name=unidata" data-twitter-follow title="Follow @Unidata on Twitter" tabindex="-1"><paper-button><core-icon icon="social:post-twitter"></core-icon>Twitter</paper-button></a>
      <a href="https://github.com/Unidata/awips2"><paper-button class="github" tabindex="-1"><core-icon icon="social:post-github"></core-icon>GitHub</paper-button></a>
      <a href="https://github.com/Unidata/awips2/issues/new" tabindex="-1"><paper-button><core-icon icon="bug-report"></core-icon>File a bug</paper-button></a>
    </div>

  </div>
</footer>





<script src="/awips2/js/prettify/prettify.js"></script>

<!-- <script src="/awips2/js/bower_components/smoothscroll/smoothscroll.js"></script> -->
<script src="/awips2/js/app.js?20170404"></script>


  </scroll-area>

</main>

</body>
</html>
